{% extends "layout.html" %}

{% block title %}
    Inventory
{% endblock %}

{% block main %}

    <div class="additem">
        <button type="button" id="open-inv-select"><h3>Inventory</h3></button>
        <ul id="invcatselect" style="display: none;">
            <li class="invcat"><a href="/off-site">Off-site</a></li>
            <li class="invcat"><a href="/replace">Replace</a></li>
            <li class="invcat"><a href="/missing">Missing</a></li>
            <li class="invcat"><a href="/archive">Archive</a></li>
        </ul>
        <div class="action-menu-wrapper">
            <button type="button" class="btn btn-primary action-menu-button">
                Action
            </button>
            {% if not inventory %}
            {% else %}
                <button type="button" class="btn btn-primary" id='confirmedit' data-bs-toggle='modal' data-bs-target='#edit-info-modal'>
                    Done
                </button>
                <button type="button" class="btn btn-primary" id='confirmreplace' data-bs-toggle='modal' data-bs-target='#replace-items-modal'>
                    Done
                </button>
                <button type="button" class="btn btn-primary" id='confirmmissing' data-bs-toggle='modal' data-bs-target='#missing-items-modal'>
                    Done
                </button>
                <button type="button" class="btn btn-primary" id='confirmarchive' data-bs-toggle='modal' data-bs-target='#archive-items-modal'>
                    Done
                </button>
                <button type="button" class="btn btn-primary" id='confirmdel' data-bs-toggle='modal' data-bs-target='#delete-items-modal'>
                    Done
                </button>
            {% endif %}
            <ul class="action-menu" style="display: none;">
                {% if not inventory %}
                {% else %}
                    <li class="action-option"><button type='button' class='action-option-button' id="clear-filters">Clear Filters</button></li>
                {% endif %}
                <li class="action-option"><button type="button" class="addbutton action-option-button">Add item</button></li>
                <li class="action-option"><a href="/upload_inventory" class="upload-inventory-button"><button type="button" class="action-option-button">Upload Inventory</button></a></li>
                {% if not inventory %}
                {% else %}
                <li class="action-option"><button type="button" class="editbutton action-option-button">Edit Items</button></li>
                    <li class="action-option"><button type="button" class="replacebutton action-option-button">Mark for Replacement</button></li>
                    <li class="action-option"><button type="button" class="missingbutton action-option-button">Mark as Missing</button></li>
                    <li class="action-option"><button type="button" class="action-option-button archivebutton">Archive Items</button></li>
                    <li class="action-option"><button type="button" class="delbutton action-option-button">Delete Items</button></li>
                {% endif %}
            </ul>
        </div>
    </div>

    <!-- Modal for adding to inventory -->
    <form action="/admin_inventory" method="post" autocomplete="off">
        <div class="modal fade" id="addInvModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="addInvModalLabel">Add Item</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Equipment input -->
                        <div class="mb-3">
                            <label for="equipment" class="form-label">Equipment Name</label>
                            <input autocomplete="off" type="text" class="form-control" id="equipment" name="equipment" placeholder="Equipment Name" aria-describedby="emailHelp">
                        </div>
                        <!-- Model input -->
                        <div class="mb-3">
                            <label for="model" class="form-label">Model</label>
                            <input autocomplete="off" type="text" class="form-control" id="model" name="model" placeholder="Model Name">
                        </div>
                        <!-- Serial input -->
                        <div class="mb-3">
                            <label for="serial" class="form-label">Serial Number</label>
                            <input autocomplete="off" type="text" class="form-control" id="serial" name="serial" placeholder="Serial Number">
                        </div>
                        <!-- EE input -->
                        <div class="mb-3">
                            <label for="ee" class="form-label">EE</label>
                            <input autocomplete="off" type="text" class="form-control" id="ee" name="ee" placeholder="EE">
                        </div>
                        <!-- Assigned department input and selection -->
                        <label for="location" class="form-label">
                            <button type="button" id="input-button">Input</button> or <button type="button" id="select-button">Select</button> Assigned Location
                        </label>
                        <!-- Assigned department input -->
                        <div id="admin-li" style="display: block;">
                            <div class="mb-3">
                                <input autocomplete="off" type="text" class="form-control" id="dinput" name="dinput" placeholder="Department">
                            </div>
                            <div class="mb-3">
                                <input autocomplete="off" type="text" class="form-control" id="rinput" name="rinput" placeholder="Room">
                            </div>
                        </div>
                        <!-- Assigned department selection -->
                        <div id="admin-ls">
                            <div class="mb-3">
                                <select id="dselect" class="form-select w-auto" name="dselect">
                                    <option disabled="" selected>Department</option>
                                    {% for dept in depts %}
                                        {% if dept.building == "NA" %}
                                        {% else %}
                                            <option value="{{ dept.building }}" class="{{ dept.id }}">{{ dept.building }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <select id="rselect" class="form-select w-auto" name="rselect">
                                    <option disabled="" selected>Room</option>
                                    {% for room in rooms %}
                                        {% if room.rooms == "NA" %}
                                        {% else %}
                                            <option value="{{ room.rooms }}" class="{{ room.department_id }}">{{ room.rooms }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <!-- Date added input -->
                        <div class="mb-3">
                            <label for="date_added" class="form-label">Date Added</label>
                            <input autocomplete="off" type="date" class="form-control" id="date_added" name="date_added"  value="{{ today }}">
                        </div>
                        <!-- Replacement date input -->
                        <div class="mb-3">
                            <label for="replace_date" class="form-label">Replacement Date</label>
                            <input autocomplete="off" type="date" class="form-control" id="replace_date" name="replace_date">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="mod-flexbox">
                            <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal" id="cancelconfirminv">Close</button>
                            <button type="button" class="btn btn-primary modal-footer-buttons" id="confirminv" name="invbutton" value="add">Add</button>
                        </div>
                        <div class="mod-flexbox">
                            <p class="emptywarning">Fields cannot be empty.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    {% if not inventory %}
        <h3 class="nodata">No data available.</h3>
    {% else %}
        {% if no_date_match %}
            {% if no_date_match == 1 %}
            <h3 class="nodate">No date matches filter selection.</h3>
            {% endif %}
        {% endif %}
        <!-- Table -->
        <div class="tboundary">
            <table class="table table-striped">
                <form action="/admin_inventory" method="get" id="filterform">
                    <thead>
                        <tr>
                            
                            <!-- Equipment filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Equipment
                                </button>
                                <select id="filterequipment" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filterequipment %}
                                        <option hidden selected>{{ filterequipment }}</option>
                                        <option>Equipment</option>
                                    {% else %}
                                        <option selected>Equipment</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["equipment"] }}</option>
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Model location filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Model
                                </button>
                                <select id="filtermodel" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filtermodel %}
                                        <option hidden selected>{{ filtermodel }}</option>
                                        <option>Model</option>
                                    {% else %}
                                        <option selected>Model</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["model"] }}</option>
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Serial filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Serial
                                </button>
                                <select id="filterserial" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filterserial %}
                                        <option hidden selected>{{ filterserial }}</option>
                                        <option>Serial</option>
                                    {% else %}
                                        <option selected>Serial</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["serial"] }}</option>
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- EE filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    EE
                                </button>
                                <select id="filteree" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filteree %}
                                        <option hidden selected>{{ filteree }}</option>
                                        <option>EE</option>
                                    {% else %}
                                        <option selected>EE</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["ee"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Assigned location filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Assigned Location
                                </button>
                                <!-- Filter search by -->
                                <select id="filtersbal" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filtersbal %}
                                        {% if filtersbal == "Assigned Location" %}
                                            <option hidden selected>{{ filtersbal }}</option>
                                            <option>Location</option>
                                            <option>Department</option>
                                            <option>Room</option>
                                        {% else %}
                                            <option>Assigned Location</option>
                                            {% if filtersbal == "Location" %}
                                                <option selected>Location</option>
                                                <option>Department</option>
                                                <option>Room</option>
                                            {% elif filtersbal == "Department" %}
                                                <option>Location</option>
                                                <option selected>Department</option>
                                                <option>Room</option>
                                            {% elif filtersbal == "Room" %}
                                                <option>Location</option>
                                                <option>Department</option>
                                                <option selected>Room</option>
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        <option hidden selected>Assigned Location</option>
                                        <option>Location</option>
                                        <option>Department</option>
                                        <option>Room</option>
                                    {% endif %}
                                </select>
                                <!-- Filter location -->
                                <select id="filteral" class="form-select" name="filter" style="display: none;">
                                    {% if filteral %}
                                        <option hidden selected>{{ filteral }}</option>
                                        <option>Location</option>
                                    {% else %}
                                        <option selected>Location</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["assigned_location"] }}</option> 
                                    {% endfor %}
                                </select>
                                <!-- Filter department -->
                                <select id="filterad" class="form-select" name="filter" style="display: none;">
                                    {% if filterad %}
                                        <option hidden selected>{{ filterad }}</option>
                                        <option>Department</option>
                                    {% else %}
                                        <option selected>Department</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["assigned_department"] }}</option> 
                                    {% endfor %}
                                </select>
                                <!-- Filter room -->
                                <select id="filterar" class="form-select" name="filter" style="display: none;">
                                    {% if filterar %}
                                        <option hidden selected>{{ filterar }}</option>
                                        <option>Room</option>
                                    {% else %}
                                        <option selected>Room</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["assigned_room"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Current location filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Current Location
                                </button>
                                <!-- Filter search by -->
                                <select id="filtersbcl" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filtersbcl %}
                                        {% if filtersbcl == "Current Location" %}
                                            <option hidden selected>{{ filtersbcl }}</option>
                                            <option>Location</option>
                                            <option>Department</option>
                                            <option>Room</option>
                                            <option>Off-site Location</option>
                                        {% else %}
                                            <option>Current Location</option>
                                            {% if filtersbcl == "Location" %}
                                                <option selected>Location</option>
                                                <option>Department</option>
                                                <option>Room</option>
                                                <option>Off-site Location</option>
                                            {% elif filtersbcl == "Department" %}
                                                <option>Location</option>
                                                <option selected>Department</option>
                                                <option>Room</option>
                                                <option>Off-site Location</option>
                                            {% elif filtersbcl == "Room" %}
                                                <option>Location</option>
                                                <option>Department</option>
                                                <option selected>Room</option>
                                                <option>Off-site Location</option>
                                            {% elif filtersbcl == "Off-site Location" %}
                                                <option>Location</option>
                                                <option>Department</option>
                                                <option>Room</option>
                                                <option selected>Off-site Location</option>
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        <option hidden selected>Current Location</option>
                                        <option>Location</option>
                                        <option>Department</option>
                                        <option>Room</option>
                                        <option>Off-site Location</option>
                                    {% endif %}
                                </select>
                                <!-- Filter location -->
                                <select id="filtercl" class="form-select" name="filter" style="display: none;">
                                    {% if filtercl %}
                                        <option hidden selected>{{ filtercl }}</option>
                                        <option>Location</option>
                                    {% else %}
                                        <option selected>Location</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                            <option>{{ item["current_location"] }}</option>
                                    {% endfor %}
                                </select>
                                <!-- Filter department -->
                                <select id="filtercd" class="form-select" name="filter" style="display: none;">
                                    {% if filtercd %}
                                        <option hidden selected>{{ filtercd }}</option>
                                        <option>Department</option>
                                    {% else %}
                                        <option selected>Department</option>
                                    {% endif %}
                                    {% for item in inventory %}
                                            <option>{{ item["current_department"] }}</option> 
                                    {% endfor %}
                                </select>
                                <!-- Filter room -->
                                <select id="filtercr" class="form-select" name="filter" style="display: none;">
                                    {% if filtercr %}
                                        <option hidden selected>{{ filtercr }}</option>
                                        <option>Room</option>
                                    {% else %}
                                        <option selected>Room</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                            <option>{{ item["current_room"] }}</option> 
                                    {% endfor %}
                                </select>
                                 <!-- Filter off-site location -->
                                <select id="filterosl" class="form-select" name="filter" style="display: none;">
                                    {% if filterosl %}
                                        <option hidden selected>{{ filterosl }}</option>
                                        <option>Off-site Location</option>
                                    {% else %}
                                        <option selected>Off-site Location</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                            <option>{{ item["off_site_location"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Status filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Status
                                </button>
                                <select id="filterstatus" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filterstatus %}
                                        <option hidden selected>{{ filterstatus }}</option>
                                        <option>Status</option>
                                    {% else %}
                                        <option selected>Status</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["status"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>
                            
                            <!-- Scanned Name filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Scanned By
                                </button>
                                <select id="filtersb" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filtersb %}
                                        <option hidden selected>{{ filtersb }}</option>
                                        <option>Scanned By</option>
                                    {% else %}
                                        <option selected>Scanned By</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        {% if item["scanned_first_name"] == "NA" %}
                                            <option>{{ item["scanned_first_name"] }}</option> 
                                        {% else %}
                                            <option>{{ item["scanned_name"] }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Received Name filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Received By
                                </button>
                                <select id="filterrb" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filterrb %}
                                        <option hidden selected>{{ filterrb }}</option>
                                        <option>Received By</option>
                                    {% else %}
                                        <option selected>Received By</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        {% if item["received_first_name"] == "NA" %}
                                            <option>{{ item["received_first_name"] }}</option> 
                                        {% else %}
                                            <option>{{ item["received_name"] }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Action filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Action
                                </button>
                                <select id="filteraction" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filteraction %}
                                        <option hidden selected>{{ filteraction }}</option>
                                        <option>Action</option>
                                    {% else %}
                                        <option selected>Action</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["action"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Date of action filter -->
                            <th class="text-center">
                                <button type="button" class="filterButtonDate">
                                    Date of Action
                                </button>
                                <div class="start-date-wrapper">
                                    {% if filter_start_doa %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-doa" name="filterdate" value="{{ filter_start_doa }}" style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-doa" name="filterdate" style="display: none;">
                                    {% endif %}
                                </div>
                                <div class="end-date-wrapper">
                                    {% if filter_end_doa %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-doa" name="filterdate" value="{{ filter_end_doa }}" style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-doa" name="filterdate" style="display: none;">
                                    {% endif %}
                                </div>
                            </th>

                            <!-- Date added filter -->
                            <th class="text-center">
                                <button type="button" class="filterButtonDate">
                                    Date Added
                                </button>
                                <div class="start-date-wrapper">
                                    {% if filter_start_da %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-da" name="filterdate" value="{{ filter_start_da }}" style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-da" name="filterdate" style="display: none;">
                                    {% endif %}
                                </div>
                                <div class="end-date-wrapper">
                                    {% if filter_end_da %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-da" name="filterdate" value="{{ filter_end_da }}"  style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-da" name="filterdate" style="display: none;">
                                    {% endif %}
                                </div>
                            </th>

                            <!-- Added by filter -->
                            <th class="text-center">
                                <button type="button" class="filterbutton">
                                    Added By
                                </button>
                                <select id="filteraddedby" class="form-select w-auto" name="filter" style="display: none;">
                                    {% if filteraddedby %}
                                        <option hidden selected>{{ filteraddedby }}</option>
                                        <option>Added By</option>
                                    {% else %}
                                        <option selected>Added By</option>
                                    {% endif %}
                                    {% for item in inventory %} 
                                        <option>{{ item["added_name"] }}</option> 
                                    {% endfor %}
                                </select>
                            </th>

                            <!-- Replace date filter -->
                            <th class="text-center">
                                <button type="button" class="filterButtonDate">
                                    Replace Date
                                </button>
                                <div class="start-date-wrapper">
                                    {% if filter_start_rd %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-rd" name="filterdate" value="{{ filter_start_rd }}" style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">Start Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-start-rd" name="filterdate" style="display: none;"> 
                                    {% endif %}
                                </div>
                                <div class="end-date-wrapper">
                                    {% if filter_end_rd %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-rd" name="filterdate" value="{{ filter_end_rd }}" style="display: none;">
                                    {% else %}
                                        <p class="date-label" style="display: none;">End Date:</p>
                                        <input autocomplete="off" type="date" class="form-control w-auto" id="filter-end-rd" name="filterdate" style="display: none;">
                                    {% endif %}
                                </div>
                            </th>

                        </tr>
                    </thead>
                </form>
                <tbody id="tables" class="click_for_info">
                    {% for i in range(inventory | length) %}
                        <tr class="showrow">
                            <td class="text-center cell-content0">
                                <input type="checkbox" value="{{ inventory[i]['qr_code'] }}" class="editinventory" name="editinv" form="edit-checkbox-form">
                                <input type="checkbox" value="{{ inventory[i]['qr_code'] }}" class="replaceinventory" name="replaceinv" form="checkbox-form">
                                <input type="checkbox" value="{{ inventory[i]['qr_code'] }}" class="missinginventory" name="missinginv" form="checkbox-form">
                                <input type="checkbox" value="{{ inventory[i]['qr_code'] }}" class="archiveinventory" name="archiveinv" form="checkbox-form">
                                <input type="checkbox" value="{{ inventory[i]['qr_code'] }}" class="deleteinventory" name="delinv" form="checkbox-form">
                                <input type='hidden' name='hiddenaction' value="{{ inventory[i]['action'] }}">
                                <input type='hidden' name='hiddenstatus' value="{{ inventory[i]['status'] }}">
                                <button type="button" name="showinfo" value="{{ inventory[i]['qr_code'] }}">{{ inventory[i]["equipment"] }}</button>
                            </td>
                            <td class="text-center cell-content1">{{ inventory[i]["model"] }}</td>
                            <td class="text-center cell-content2">{{ inventory[i]["serial"] }}</td>
                            <td class="text-center cell-content3">{{ inventory[i]["ee"] }}</td>
                            <td class="text-center cell-content4">{{ inventory[i]["assigned_room"] }}-{{ inventory[i]["assigned_department"] }}</td>
                            {% if inventory[i]["off_site_location"] == "NA" %} 
                                <td class="text-center cell-content5">{{ inventory[i]["current_room"] }}-{{ inventory[i]["current_department"] }}</td>
                            {% else %}
                                <td class="text-center cell-content5">{{ inventory[i]["off_site_location"] }}</td>
                            {% endif %}
                            <td class="text-center cell-content6">{{ inventory[i]["status"] }}</td>
                            {% if inventory[i]["scanned_first_name"] == "NA" %} 
                                <td class="text-center cell-content7">{{ inventory[i]["scanned_first_name"] }}</td>
                            {% else %}
                                <td class="text-center cell-content7">{{ inventory[i]["scanned_name"] }}</td>
                            {% endif %}
                            {% if inventory[i]["received_first_name"] == "NA" %} 
                                <td class="text-center cell-content8">{{ inventory[i]["received_first_name"] }}</td>
                            {% else %}
                                <td class="text-center cell-content8">{{ inventory[i]["received_name"] }}</td>
                            {% endif %}
                            <td class="text-center cell-content9">{{ inventory[i]["action"] }}</td>
                            <td class="text-center cell-content10">{{ inventory[i]["date_of_action"] }}</td>
                            <td class="text-center cell-content11">{{ inventory[i]["date_added"] }}</td>
                            <td class="text-center cell-content12">{{ inventory[i]["added_name"] }}</td>
                            <td class="text-center cell-content13">{{ inventory[i]["repl_date"] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <nav class="pages" aria-label="Page navigation">
    </nav>

    <form action="/admin_inventory" method="post" id="checkbox-form">
        <!-- Modal for sending items to be replaced -->
        <div class="modal fade" id="replace-items-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="replaceItemsModalLabel">Replace Items</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Send to replace page?</label><br>
                            <div class="mod-flexbox">
                                <button id="closereplace" type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <button id="completereplace" type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton" value="replace">Confirm</button>
                            </div>                            
                        </div>
                        <p class="emptyselection" style="display: none;">Please make a selection.</p>
                        <p class="notcheckedin" style="display: none;">All items must be checked in.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal for sending items to missing page -->
        <div class="modal fade" id="missing-items-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="missingItemsModalLabel">Missing Items</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Are these items missing?</label><br>
                            <div class="mod-flexbox">
                                <button id="closemissing" type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <button id="completemissing" type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton" value="missing">Confirm</button>
                            </div>
                        </div>
                        <p class="emptyselection" style="display: none;">Please make a selection.</p>
                        <p class="already-missing" style="display: none;">Item is already missing.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal for archiving items -->
        <div class="modal fade" id="archive-items-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="archiveItemsModalLabel">Archive Items</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Send to archive?</label><br>
                            <div class="mod-flexbox">
                                <button id="closearchive" type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <button id="completearchive" type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton" value="archive">Confirm</button>
                            </div>
                        </div>
                        <p class="emptyselection" style="display: none;">Please make a selection.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal for deleting items -->
        <div class="modal fade" id="delete-items-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="deleteItemsModalLabel">Delete Items</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Delete these items?</label><br>
                            <div class="mod-flexbox">
                                <button id="closedel" type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <button id="completedel" type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton" value="delete">Confirm</button>
                            </div>
                        </div>
                        <p class="emptyselection" style="display: none;">Please make a selection.</p>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for additional equipment information -->
    <form action="/admin_inventory" method="post">
        <div class="modal fade" id="moreinfo" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Additional Information</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <label for="qrcode" class="form-label">QR Code</label>
                        <div class="mb-3 qrflex">
                            <img class="img-fluid" id="additional-info-qr">
                        </div>
                        <div class="mb-3">
                            <a id="downloadqrcode" href="" download><button type="button" class="btn btn-primary downloadqr">Download QR Code</button></a>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary additional-info-buttons" id="edit-item">Edit Item</button>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary additional-info-buttons" id="single-item-replace">Replace Item</button>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary additional-info-buttons" id="single-item-missing">Mark as Missing</button>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary additional-info-buttons" id="single-item-archive">Archive Item</button>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary additional-info-buttons" id="delete-item">Delete item</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for editing inventory item -->
    <form action="/admin_inventory" method="post" id="edit-checkbox-form" autocomplete="off">
        <div class="modal fade" id="edit-info-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="editInfoModalLabel">Edit Item</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="edit-equipment" class="form-label">Equipment Name</label>
                            <input autocomplete="off" type="text" class="form-control" id="edit-equipment" name="edit-field" placeholder="Equipment Name">
                        </div>
                        <div class="mb-3">
                            <label for="edit-model" class="form-label">Model</label>
                            <input autocomplete="off" type="text" class="form-control" id="edit-model" name="edit-field" placeholder="Model Name">
                        </div>
                        <div class="mb-3">
                            <label for="edit-serial" class="form-label">Serial Number</label>
                            <input autocomplete="off" type="text" class="form-control" id="edit-serial" name="edit-field" placeholder="Serial Number">
                        </div>
                        <div class="mb-3">
                            <label for="edit-ee" class="form-label">EE</label>
                            <input autocomplete="off" type="text" class="form-control" id="edit-ee" name="edit-field" placeholder="Serial Number">
                        </div>
                        <!-- Assigned department input and selection -->
                        <label for="edit-location" class="form-label">
                            <button type="button" id="edit-input-button">Input</button> or <button type="button" id="edit-select-button">Select</button> Assigned Location
                        </label>
                        <!-- Assigned department input -->
                        <div id="admin-edit-li" style="display: block;">
                            <div class="mb-3">
                                <input autocomplete="off" type="text" class="form-control" id="edit-dinput" name="edit-field" placeholder="Department">
                            </div>
                            <div class="mb-3">
                                <input autocomplete="off" type="text" class="form-control" id="edit-rinput" name="edit-field" placeholder="Room">
                            </div>
                        </div>
                        <!-- Assigned department selection -->
                        <div id="admin-edit-ls">
                            <div class="mb-3">
                                <select id="edit-dselect" class="form-select w-auto" name="edit-field">
                                    <option selected>Department</option>
                                    {% for dept in depts %}
                                        {% if dept.building == "NA" %}
                                        {% else %}
                                            <option value="{{ dept.building }}" class="{{ dept.id }}">{{ dept.building }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <select id="edit-rselect" class="form-select w-auto" name="edit-field">
                                    <option selected>Room</option>
                                    {% for room in rooms %}
                                        {% if room.rooms == "NA" %}
                                        {% else %}
                                            <option value="{{ room.rooms }}" class="{{ room.department_id }}">{{ room.rooms }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="edit-replace-date" class="form-label">Replacement Date</label>
                            <input autocomplete="off" type="date" class="form-control" id="edit-replace-date" name="edit-field">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="mod-flexbox">
                            <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal" id="closeedit">Close</button>
                            <input type='hidden' id='hidden-edit-item' name='hidden-edit-item'>
                            <button type="button" class="btn btn-primary modal-footer-buttons" id="completeedit" name="invbutton" value="edit">Confirm Edit</button>
                        </div>
                        <div class="mod-flexbox" id="warnings">
                            <p class="emptywarning">At least one field must be filled out.</p>
                            <p class="emptyselection" style="display: none;">Please make a selection.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for replacing single item -->
    <form action="/admin_inventory" method="post">
        <div class="modal fade" id="replace-single-item-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="missingSingleItemModalLabel">Replace Item</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Mark item for replacement?</label><br>
                            <div class="mod-flexbox">
                                <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <input type='hidden' id='hidden-replace-item' name='hidden-replace-item'>
                                <button type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for marking single item as missing -->
    <form action="/admin_inventory" method="post">
        <div class="modal fade" id="missing-single-item-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="missingSingleItemModalLabel">Missing Item</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Mark item as missing?</label><br>
                            <div class="mod-flexbox">
                                <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <input type='hidden' id='hiddenmissingitem' name='hiddenmissingitem'>
                                <button type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for archiving single item -->
    <form action="/admin_inventory" method="post">
        <div class="modal fade" id="archive-single-item-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="archiveSingleItemModalLabel">Archive Item</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Send to archive?</label><br>
                            <div class="mod-flexbox">
                                <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <input type='hidden' id='hidden-archive-item' name='hidden-archive-item'>
                                <button type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton">Confirm</button>
                            </div>
                        </div>
                        <p class="emptyselection" style="display: none;">Please make a selection.</p>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal for deleting single item -->
    <form action="/admin_inventory" method="post">
        <div class="modal fade" id="delSingleInvModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropdelLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="delSingleInvModalLabel">Delete Item</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Confirm Deletion?</label><br>
                            <div class="mod-flexbox">
                                <button type="button" class="btn btn-secondary modal-footer-buttons" data-bs-dismiss="modal">Cancel</button>
                                <input type='hidden' id='hidden-delete-item' name='hidden-delete-item'>
                                <button type="submit" class="btn btn-primary modal-footer-buttons" name="invbutton">Confirm Deletion</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

{% endblock %}

{% block script %}

    <script src="/static/app.js"></script>
    <script>

        var showinfo = document.getElementsByName("showinfo");
        var img = document.querySelector("#additional-info-qr");
        var showmodal = document.querySelector("#showmodal");
        var moreInfoModal = new bootstrap.Modal(document.getElementById("moreinfo"));
        var editInfoModal = new bootstrap.Modal(document.getElementById("edit-info-modal"));
        var addInvModal = new bootstrap.Modal(document.getElementById("addInvModal"));
        var replaceSingleItemModal = new bootstrap.Modal(document.getElementById("replace-single-item-modal"));
        var missingSingleItemModal = new bootstrap.Modal(document.getElementById("missing-single-item-modal"));
        var archiveSingleItemModal = new bootstrap.Modal(document.getElementById("archive-single-item-modal"));
        var delSingleInvModal = new bootstrap.Modal(document.getElementById("delSingleInvModal"));
        var editItem = document.getElementById("edit-item");
        var addbutton = document.querySelector(".addbutton");
        var replaceSinglebutton = document.getElementById("single-item-replace");
        var missingSinglebutton = document.getElementById("single-item-missing");
        var archiveSinglebutton = document.getElementById("single-item-archive");
        var deleteSinglebutton = document.getElementById("delete-item");
        var nodate = document.querySelector(".nodate");
        
        for (let i = 0; i < showinfo.length; i++)
        {
            showinfo[i].addEventListener("click", function() {
                
                var data = new FormData()
                data.append("showinfo",  showinfo[i].value)
                var admin_url = "{{ url_for('admin_inventory') }}"
                fetch(admin_url, {
                    "method": "POST",
                    "body": data,
                }).then((response) => {
                    
                    return response.json()

                }).then((result) => {

                    img.src = "/static/qrcodes/"+ result['qr_code'] +".png";
                    document.getElementById("hidden-replace-item").value = result['qr_code'];
                    document.getElementById("hiddenmissingitem").value = result['qr_code'];
                    document.getElementById("hidden-edit-item").value = result['qr_code'];
                    document.getElementById("hidden-archive-item").value = result['qr_code'];
                    document.getElementById("hidden-delete-item").value = result['qr_code'];
                    document.getElementById("downloadqrcode").href = "static/qrcodes/"+result['qr_code']+".png";

                    console.log(result['status'])

                    if (result['status'] == "REPLACE" || result['status'] == "REPLACED")
                    {
                        document.querySelector("#single-item-replace").style.display = "none";
                        document.querySelector("#single-item-replace").disabled = true;
                    }
                    else if (result['status'] != "REPLACE" || result['status'] != "REPLACED")
                    {
                        document.querySelector("#single-item-replace").style.display = "block";
                        document.querySelector("#single-item-replace").disabled = false;
                    }

                    if (result['status'] == "MISSING")
                    {
                        document.querySelector("#single-item-missing").style.display = "none";
                        document.querySelector("#single-item-missing").disabled = true;
                    }
                    else if (result['status'] != "MISSING")
                    {
                        document.querySelector("#single-item-missing").style.display = "block";
                        document.querySelector("#single-item-missing").disabled = false;
                    }

                    if (result['status'] != "REPLACED")
                    {
                        document.querySelector("#single-item-archive").style.display = "none";
                        document.querySelector("#single-item-archive").disabled = true;
                    }
                    else if (result['status'] == "REPLACED")
                    {
                        document.querySelector("#single-item-archive").style.display = "block";
                        document.querySelector("#single-item-archive").disabled = false;
                    }

                });

                moreInfoModal.show();

            });
        }

        addbutton.addEventListener("click", function() {

            addInvModal.show();

        });

        editItem.addEventListener("click", function() {

            moreInfoModal.hide();
            editInfoModal.show();
            
        });

        replaceSinglebutton.addEventListener("click", function() {

            moreInfoModal.hide();
            replaceSingleItemModal.show();

        });

        missingSinglebutton.addEventListener("click", function() {

            moreInfoModal.hide();
            missingSingleItemModal.show();

        });

        archiveSinglebutton.addEventListener("click", function() {

            moreInfoModal.hide();
            archiveSingleItemModal.show();

        });

        deleteSinglebutton.addEventListener("click", function() {

            moreInfoModal.hide();
            delSingleInvModal.show();

        });

        if (nodate)
        {
            nodate.addEventListener("animationend", function() {
                nodate.style.display = "none";
            });
        }

    </script>

{% endblock %}